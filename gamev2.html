<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Mängulaud</title>
		<style>
			body {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				height: 100vh;
				margin: 0;
			}
			table {
				border-collapse: collapse;
			}
			td {
				width: 80px;
				height: 80px;
				text-align: center;
				vertical-align: middle;
				font-size: 20px;
				font-family: Arial, sans-serif;
				position: relative;
				cursor: pointer;
			}
			.even {
				background-color: white;
				border: 1px solid;
			}
			.odd {
				background-color: grey;
				border: 1px solid;
			}
			.empty {
				visibility: hidden;
			}
			.selected {
				background-color: yellow !important;
			}
			#position-display {
				margin-top: 20px;
				font-size: 18px;
				font-family: Arial, sans-serif;
			}
			#position-display.hidden {
				display: none;
			}
			.finishline {
				font-size: 40px;
				border: 1px solid;
			}
			.startline {
				font-size: 40px;
				border: 1px solid;
			}
			.ai {
				background-color: red !important;
			}
		</style>
	</head>
	<body>
		<div id="game-container"></div>
		<div id="position-display">Alustamiseks liigu esimese või teise rea ruudule, mis järgneb START reale.</div>
		<script>
			let maxY;

			const squares = document.querySelectorAll("td");
			const positionDisplay = document.getElementById("position-display");

			function generateGrid(rows, cols) {
				const gameContainer = document.getElementById("game-container");
				const table = document.createElement("table");

				const startRow = document.createElement("tr");
				const startCell = document.createElement("td");
				startCell.textContent = "START";
				startCell.classList.add("startline", "selected");
				startCell.colSpan = cols;
				startCell.dataset.x = 0;
				startCell.dataset.y = 0;
				startCell.style.pointerEvents = "auto";
				startCell.addEventListener("click", handleCellClick);
				startRow.appendChild(startCell);
				table.appendChild(startRow);

				let number = 1;
				let bottomNumber = 2;
				maxY = rows + 1;

				for (let y = 1; y <= rows; y++) {
					const row = document.createElement("tr");

					for (let x = 1; x <= cols; x++) {
						const cell = document.createElement("td");

						cell.dataset.x = x;
						cell.dataset.y = y;

						if (y % 2 === 1) {
							if (x % 2 === 0) {
								cell.textContent = number;
								cell.classList.add("odd");
								cell.style.pointerEvents = "auto";
								number += 2;
							} else {
								cell.textContent = "-";
								cell.classList.add("empty");
								cell.style.pointerEvents = "none";
							}
						} else {
							if (x % 2 === 1) {
								cell.textContent = bottomNumber;
								cell.classList.add("even");
								cell.style.pointerEvents = "auto";
								bottomNumber += 2;
							} else {
								cell.textContent = "-";
								cell.classList.add("empty");
								cell.style.pointerEvents = "none";
							}
						}

						cell.addEventListener("click", handleCellClick);

						row.appendChild(cell);
					}

					table.appendChild(row);
				}

				const finishRow = document.createElement("tr");
				const finishCell = document.createElement("td");
				finishCell.textContent = "FINISH";
				finishCell.classList.add("finishline");
				finishCell.colSpan = cols;
				finishCell.dataset.x = 0;
				finishCell.dataset.y = maxY;
				finishCell.style.pointerEvents = "auto";
				finishCell.addEventListener("click", handleCellClick);
				finishRow.appendChild(finishCell);
				table.appendChild(finishRow);

				gameContainer.appendChild(table);
			}

			function handleCellClick(event) {
				const currentSquare = document.querySelector(".selected");
				const newSquare = event.target;

				if (newSquare.classList.contains("startline")) {
					if (currentSquare) {
						currentSquare.classList.remove("selected");
					}
					newSquare.classList.add("selected");
					updatePositionDisplay(newSquare);
				} else {
					if (isValidMove(currentSquare, newSquare)) {
						if (currentSquare) {
							currentSquare.classList.remove("selected");
						}
						newSquare.classList.add("selected");
						updatePositionDisplay(newSquare);
					} else {
						alert("Sa saad liikuda ainult paremale, vasakule, üles või alla.");
					}
				}
			}

			function isValidMove(current, target) {
				const currX = parseInt(current.dataset.x, 10);
				const currY = parseInt(current.dataset.y, 10);
				const targetX = parseInt(target.dataset.x, 10);
				const targetY = parseInt(target.dataset.y, 10);

				if (currY === 0 && (targetY === 1 || targetY === 2)) {
					return true;
				}
				else if ((currY === 1 || currY === 2) && targetY === 0) {
					return true;
				}
				else if ((currY === maxY - 1 || currY === maxY - 2) && targetY === maxY) {
					return true;
				} else if (currY === maxY && (targetY === maxY - 1 || targetY === maxY - 2)) {
					return true;
				}
				else if ((currX === targetX && Math.abs(currY - targetY) === 2) || (currY === targetY && Math.abs(currX - targetX) === 2)) {
					return true;
				}
				else {
					return false;
				}
			}

			function updatePositionDisplay(square) {
				const x = square.dataset.x;
				const y = square.dataset.y;
				const value = square.textContent;

				positionDisplay.textContent = `Asukoht: (${x}, ${y}) ruut ${value}`;
			}

			generateGrid(6, 7);
		</script>
	</body>
</html>
